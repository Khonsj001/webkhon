<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Analysis App</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Lao:wght@300;400;500;600;700&family=Poppins:wght@300;400;500;600;700&display=swap');

        *{
            
            font-family: 'Noto Sans Lao', 'Poppins', sans-serif;

        }
    </style>
</head>
<body class="bg-white dark:bg-gray-900 text-gray-800 dark:text-gray-200 transition-colors duration-200">
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <header class="flex justify-between items-center mb-8">
            <h1 class="text-3xl font-bold text-purple-600 dark:text-purple-400" data-lang-key="title">Data Analysis Demo</h1>
            <div class="flex items-center">
                <label for="language-selector" class="mr-2 text-sm" data-lang-key="language">Language:</label>
                <select id="language-selector" class="bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded px-3 py-1 text-base">
                    <option value="en">English</option>
                    <option value="lo">ລາວ (Lao)</option>
                </select>
            </div>
        </header>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <!-- Sample Data Section -->
            <div class="md:col-span-1 bg-gray-100 dark:bg-gray-800 p-4 rounded-lg shadow">
                <h2 class="text-xl font-semibold mb-4 text-purple-600 dark:text-purple-400" data-lang-key="sample_data">Sample Data</h2>
                <div class="mb-4">
                    <label for="data-select" class="block mb-2" data-lang-key="select_dataset">Select Dataset:</label>
                    <select id="data-select" class="w-full bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded px-3 py-2 text-base">
                        <option value="sales" data-lang-key="sales_data">Sales Data</option>
                        <option value="temperature" data-lang-key="temperature_data">Temperature Data</option>
                        <option value="population" data-lang-key="population_data">Population Data</option>
                    </select>
                </div>
                <div class="overflow-x-auto">
                    <table id="data-table" class="min-w-full bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 text-sm">
                        <thead>
                            <tr class="bg-gray-200 dark:bg-gray-600">
                                <!-- Table headers will be populated by JavaScript -->
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Table rows will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Analysis Options -->
            <div class="md:col-span-1 bg-gray-100 dark:bg-gray-800 p-4 rounded-lg shadow">
                <h2 class="text-xl font-semibold mb-4 text-purple-600 dark:text-purple-400" data-lang-key="analysis_options">Analysis Options</h2>
                <div class="space-y-4">
                    <div>
                        <label class="block mb-2" data-lang-key="analysis_type">Analysis Type:</label>
                        <select id="analysis-type" class="w-full bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded px-3 py-2 text-base">
                            <option value="summary" data-lang-key="descriptive_stats">Descriptive Statistics</option>
                            <option value="correlation" data-lang-key="correlation">Correlation Analysis</option>
                            <option value="trend" data-lang-key="trend_analysis">Trend Analysis</option>
                        </select>
                    </div>
                    <div>
                        <label class="block mb-2" data-lang-key="visualization">Visualization:</label>
                        <select id="chart-type" class="w-full bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded px-3 py-2 text-base">
                            <option value="bar" data-lang-key="bar_chart">Bar Chart</option>
                            <option value="line" data-lang-key="line_chart">Line Chart</option>
                            <option value="pie" data-lang-key="pie_chart">Pie Chart</option>
                        </select>
                    </div>
                    <button id="analyze-btn" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded">
                        <span data-lang-key="analyze">Analyze Data</span>
                    </button>
                </div>
                <div class="mt-4">
                    <h3 class="font-medium mb-2" data-lang-key="equivalent_code">Equivalent Python Code:</h3>
                    <pre id="code-snippet" class="bg-gray-700 dark:bg-gray-800 text-white p-3 rounded text-sm overflow-x-auto"></pre>
                </div>
            </div>

            <!-- Results -->
            <div class="md:col-span-1 bg-gray-100 dark:bg-gray-800 p-4 rounded-lg shadow">
                <h2 class="text-xl font-semibold mb-4 text-purple-600 dark:text-purple-400" data-lang-key="results">Results</h2>
                <div id="results-container" class="mb-4">
                    <p class="text-gray-500 dark:text-gray-400 italic" data-lang-key="run_analysis">Run analysis to see results</p>
                </div>
                <div class="h-64">
                    <canvas id="chart-container"></canvas>
                </div>
            </div>
        </div>

        <footer class="mt-8 text-center text-sm text-gray-500 dark:text-gray-400">
            <p data-lang-key="footer_note">This is a demonstration of data analysis concepts similar to Python libraries like Pandas, NumPy, and Matplotlib.</p>
        </footer>
    </div>

    <script>
        // Check for dark mode preference
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });

        // Language dictionary
        const languages = {
            en: {
                title: "Data Analysis Demo",
                language: "Language:",
                sample_data: "Sample Data",
                select_dataset: "Select Dataset:",
                sales_data: "Sales Data",
                temperature_data: "Temperature Data",
                population_data: "Population Data",
                analysis_options: "Analysis Options",
                analysis_type: "Analysis Type:",
                descriptive_stats: "Descriptive Statistics",
                correlation: "Correlation Analysis",
                trend_analysis: "Trend Analysis",
                visualization: "Visualization:",
                bar_chart: "Bar Chart",
                line_chart: "Line Chart",
                pie_chart: "Pie Chart",
                analyze: "Analyze Data",
                equivalent_code: "Equivalent Python Code:",
                results: "Results",
                run_analysis: "Run analysis to see results",
                footer_note: "This is a demonstration of data analysis concepts similar to Python libraries like Pandas, NumPy, and Matplotlib.",
                month: "Month",
                sales: "Sales",
                department: "Department",
                city: "City",
                temperature: "Temperature",
                year: "Year",
                population: "Population",
                growth: "Growth %",
                mean: "Mean",
                median: "Median",
                min: "Min",
                max: "Max",
                std_dev: "Std Dev",
                correlation_result: "Correlation coefficient: ",
                trend_result: "Trend analysis results",
                increasing: "Increasing trend",
                decreasing: "Decreasing trend",
                no_trend: "No clear trend"
            },
            lo: {
                title: "ໂຄງການວິເຄາະຂໍ້ມູນ",
                language: "ພາສາ:",
                sample_data: "ຂໍ້ມູນຕົວຢ່າງ",
                select_dataset: "ເລືອກຊຸດຂໍ້ມູນ:",
                sales_data: "ຂໍ້ມູນການຂາຍ",
                temperature_data: "ຂໍ້ມູນອຸນຫະພູມ",
                population_data: "ຂໍ້ມູນປະຊາກອນ",
                analysis_options: "ທາງເລືອກການວິເຄາະ",
                analysis_type: "ປະເພດການວິເຄາະ:",
                descriptive_stats: "ສະຖິຕິພັນລະນາ",
                correlation: "ການວິເຄາະຄວາມສຳພັນ",
                trend_analysis: "ການວິເຄາະແນວໂນ້ມ",
                visualization: "ການສະແດງຜົນ:",
                bar_chart: "ແຜນພູມແທ່ງ",
                line_chart: "ແຜນພູມເສັ້ນ",
                pie_chart: "ແຜນພູມວົງກົມ",
                analyze: "ວິເຄາະຂໍ້ມູນ",
                equivalent_code: "ລະຫັດ Python ທຽບເທົ່າ:",
                results: "ຜົນໄດ້ຮັບ",
                run_analysis: "ດຳເນີນການວິເຄາະເພື່ອເບິ່ງຜົນໄດ້ຮັບ",
                footer_note: "ນີ້ແມ່ນການສາທິດແນວຄວາມຄິດການວິເຄາະຂໍ້ມູນຄ້າຍຄືກັບຫ້ອງສະໝຸດ Python ເຊັ່ນ Pandas, NumPy, ແລະ Matplotlib.",
                month: "ເດືອນ",
                sales: "ຍອດຂາຍ",
                department: "ພະແນກ",
                city: "ເມືອງ",
                temperature: "ອຸນຫະພູມ",
                year: "ປີ",
                population: "ປະຊາກອນ",
                growth: "ການເຕີບໂຕ %",
                mean: "ຄ່າສະເລ່ຍ",
                median: "ຄ່າກາງ",
                min: "ຄ່າຕໍ່າສຸດ",
                max: "ຄ່າສູງສຸດ",
                std_dev: "ຄ່າຜິດດ່ຽງມາດຕະຖານ",
                correlation_result: "ຄ່າສຳປະສິດສຫສຳພັນ: ",
                trend_result: "ຜົນການວິເຄາະແນວໂນ້ມ",
                increasing: "ແນວໂນ້ມເພີ່ມຂຶ້ນ",
                decreasing: "ແນວໂນ້ມຫຼຸດລົງ",
                no_trend: "ບໍ່ມີແນວໂນ້ມທີ່ຊັດເຈນ"
            }
        };

        // Sample datasets
        const datasets = {
            sales: {
                headers: ["month", "sales", "department", "city"],
                data: [
                    ["Jan", 1200, "Electronics", "New York"],
                    ["Feb", 1500, "Electronics", "New York"],
                    ["Mar", 1800, "Electronics", "New York"],
                    ["Apr", 1300, "Clothing", "Chicago"],
                    ["May", 1700, "Clothing", "Chicago"],
                    ["Jun", 2100, "Clothing", "Chicago"]
                ]
            },
            temperature: {
                headers: ["month", "temperature", "city"],
                data: [
                    ["Jan", 2, "Oslo"],
                    ["Feb", 3, "Oslo"],
                    ["Mar", 7, "Oslo"],
                    ["Apr", 12, "Oslo"],
                    ["May", 16, "Oslo"],
                    ["Jun", 20, "Oslo"]
                ]
            },
            population: {
                headers: ["year", "population", "growth"],
                data: [
                    [2015, 1000000, 1.2],
                    [2016, 1015000, 1.5],
                    [2017, 1035000, 2.0],
                    [2018, 1055000, 1.9],
                    [2019, 1070000, 1.4],
                    [2020, 1085000, 1.3]
                ]
            }
        };

        // Chart instance
        let currentChart = null;

        // DOM elements
        const languageSelector = document.getElementById('language-selector');
        const dataSelect = document.getElementById('data-select');
        const dataTable = document.getElementById('data-table');
        const analysisType = document.getElementById('analysis-type');
        const chartType = document.getElementById('chart-type');
        const analyzeBtn = document.getElementById('analyze-btn');
        const codeSnippet = document.getElementById('code-snippet');
        const resultsContainer = document.getElementById('results-container');
        const chartContainer = document.getElementById('chart-container');

        // Update language
        function updateLanguage(lang) {
            const elements = document.querySelectorAll('[data-lang-key]');
            elements.forEach(element => {
                const key = element.getAttribute('data-lang-key');
                if (languages[lang][key]) {
                    if (element.tagName === 'OPTION') {
                        element.textContent = languages[lang][key];
                    } else {
                        element.innerHTML = languages[lang][key];
                    }
                }
            });
            
            // Update dataset options text
            updateDatasetOptionsText(lang);
        }

        function updateDatasetOptionsText(lang) {
            const options = dataSelect.querySelectorAll('option');
            options.forEach(option => {
                const key = option.getAttribute('data-lang-key');
                if (languages[lang][key]) {
                    option.textContent = languages[lang][key];
                }
            });
        }

        // Display dataset
        function displayDataset(datasetName) {
            const dataset = datasets[datasetName];
            const thead = dataTable.querySelector('thead tr');
            const tbody = dataTable.querySelector('tbody');
            
            // Clear existing headers and rows
            thead.innerHTML = '';
            tbody.innerHTML = '';
            
            // Get current language
            const currentLang = languageSelector.value;
            
            // Add headers
            dataset.headers.forEach(header => {
                const th = document.createElement('th');
                th.className = 'px-4 py-2 text-left';
                th.textContent = languages[currentLang][header] || header;
                thead.appendChild(th);
            });
            
            // Add data rows
            dataset.data.forEach(row => {
                const tr = document.createElement('tr');
                tr.className = 'border-t border-gray-300 dark:border-gray-600';
                
                row.forEach((cell, index) => {
                    const td = document.createElement('td');
                    td.className = 'px-4 py-2';
                    td.textContent = cell;
                    tr.appendChild(td);
                });
                
                tbody.appendChild(tr);
            });
        }

        // Generate Python code snippet
        function generateCodeSnippet(datasetName, analysisType, chartType) {
            const currentLang = languageSelector.value;
            let code = '';
            
            if (analysisType === 'summary') {
                code = `import pandas as pd
import numpy as np
import matplotlib.pyplot as plt

# Load data
df = pd.read_csv('${datasetName}.csv')

# Descriptive statistics
stats = df['${languages[currentLang][datasets[datasetName].headers[1]] || datasets[datasetName].headers[1]}'].describe()
print(stats)

# Visualization
plt.figure(figsize=(10, 6))
plt.${chartType}(df['${languages[currentLang][datasets[datasetName].headers[0]] || datasets[datasetName].headers[0]}'], 
              df['${languages[currentLang][datasets[datasetName].headers[1]] || datasets[datasetName].headers[1]}'])
plt.title('${languages[currentLang][datasets[datasetName].headers[1]] || datasets[datasetName].headers[1]} by ${languages[currentLang][datasets[datasetName].headers[0]] || datasets[datasetName].headers[0]}')
plt.show()`;
            } else if (analysisType === 'correlation') {
                code = `import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
from scipy.stats import pearsonr

# Load data
df = pd.read_csv('${datasetName}.csv')

# Calculate correlation
corr, p_value = pearsonr(df['${languages[currentLang][datasets[datasetName].headers[1]] || datasets[datasetName].headers[1]}'], 
                         df['${languages[currentLang][datasets[datasetName].headers[2]] || datasets[datasetName].headers[2]}'])
print(f"Correlation coefficient: {corr:.2f}")

# Visualization
plt.figure(figsize=(10, 6))
plt.scatter(df['${languages[currentLang][datasets[datasetName].headers[1]] || datasets[datasetName].headers[1]}'], 
           df['${languages[currentLang][datasets[datasetName].headers[2]] || datasets[datasetName].headers[2]}'])
plt.title('Correlation Analysis')
plt.show()`;
            } else if (analysisType === 'trend') {
                code = `import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
from scipy import stats

# Load data
df = pd.read_csv('${datasetName}.csv')

# Trend analysis using linear regression
x = range(len(df))
y = df['${languages[currentLang][datasets[datasetName].headers[1]] || datasets[datasetName].headers[1]}']
slope, intercept, r_value, p_value, std_err = stats.linregress(x, y)

# Visualization
plt.figure(figsize=(10, 6))
plt.${chartType}(df['${languages[currentLang][datasets[datasetName].headers[0]] || datasets[datasetName].headers[0]}'], 
              df['${languages[currentLang][datasets[datasetName].headers[1]] || datasets[datasetName].headers[1]}'])
plt.plot(df['${languages[currentLang][datasets[datasetName].headers[0]] || datasets[datasetName].headers[0]}'], 
         intercept + slope * np.array(x), 'r--')
plt.title('Trend Analysis')
plt.show()`;
            }
            
            return code;
        }

        // Perform analysis and update results
        function performAnalysis(datasetName, analysisType, chartType) {
            const dataset = datasets[datasetName];
            const currentLang = languageSelector.value;
            let results = '';
            
            // Extract numeric column for analysis (usually column 1)
            const numericData = dataset.data.map(row => row[1]);
            
            if (analysisType === 'summary') {
                // Calculate descriptive statistics
                const sum = numericData.reduce((acc, val) => acc + val, 0);
                const mean = sum / numericData.length;
                
                // Sort data for median and other calculations
                const sortedData = [...numericData].sort((a, b) => a - b);
                const median = sortedData.length % 2 === 0 
                    ? (sortedData[sortedData.length / 2 - 1] + sortedData[sortedData.length / 2]) / 2
                    : sortedData[Math.floor(sortedData.length / 2)];
                
                const min = sortedData[0];
                const max = sortedData[sortedData.length - 1];
                
                // Standard deviation
                const sumSquaredDiffs = numericData.reduce((acc, val) => acc + Math.pow(val - mean, 2), 0);
                const stdDev = Math.sqrt(sumSquaredDiffs / numericData.length);
                
                results = `
                    <div class="grid grid-cols-2 gap-2 text-sm">
                        <div class="font-medium">${languages[currentLang].mean}:</div>
                        <div>${mean.toFixed(2)}</div>
                        <div class="font-medium">${languages[currentLang].median}:</div>
                        <div>${median.toFixed(2)}</div>
                        <div class="font-medium">${languages[currentLang].min}:</div>
                        <div>${min}</div>
                        <div class="font-medium">${languages[currentLang].max}:</div>
                        <div>${max}</div>
                        <div class="font-medium">${languages[currentLang].std_dev}:</div>
                        <div>${stdDev.toFixed(2)}</div>
                    </div>
                `;
                
                // Create chart
                createChart(
                    dataset.data.map(row => row[0]), // x-axis (labels)
                    numericData, // y-axis (values)
                    chartType,
                    `${languages[currentLang][dataset.headers[1]] || dataset.headers[1]} ${languages[currentLang].by || 'by'} ${languages[currentLang][dataset.headers[0]] || dataset.headers[0]}`
                );
                
            } else if (analysisType === 'correlation') {
                // Simple correlation analysis (if there's a third column)
                if (dataset.headers.length > 2) {
                    // For demo purposes, we'll compute a simplified correlation
                    const xValues = numericData;
                    const yValues = dataset.data.map(row => row[2]);
                    
                    // Calculate means
                    const xMean = xValues.reduce((acc, val) => acc + val, 0) / xValues.length;
                    const yMean = yValues.reduce((acc, val) => acc + val, 0) / yValues.length;
                    
                    // Calculate covariance and variances
                    let covariance = 0;
                    let xVariance = 0;
                    let yVariance = 0;
                    
                    for (let i = 0; i < xValues.length; i++) {
                        const xDiff = xValues[i] - xMean;
                        const yDiff = yValues[i] - yMean;
                        covariance += xDiff * yDiff;
                        xVariance += xDiff * xDiff;
                        yVariance += yDiff * yDiff;
                    }
                    
                    const correlation = covariance / (Math.sqrt(xVariance) * Math.sqrt(yVariance));
                    
                    results = `<p>${languages[currentLang].correlation_result} ${correlation.toFixed(2)}</p>`;
                    
                    // Create scatter plot
                    createScatterChart(
                        xValues,
                        yValues,
                        `${languages[currentLang][dataset.headers[1]] || dataset.headers[1]} vs. ${languages[currentLang][dataset.headers[2]] || dataset.headers[2]}`
                    );
                } else {
                    results = `<p>Need at least 3 columns for correlation analysis</p>`;
                }
                
            } else if (analysisType === 'trend') {
                // Simple trend analysis
                const data = numericData;
                let trend = 0;
                
                // Check if values are mostly increasing or decreasing
                for (let i = 1; i < data.length; i++) {
                    if (data[i] > data[i-1]) trend++;
                    else if (data[i] < data[i-1]) trend--;
                }
                
                let trendResult;
                if (trend > 1) {
                    trendResult = languages[currentLang].increasing;
                } else if (trend < -1) {
                    trendResult = languages[currentLang].decreasing;
                } else {
                    trendResult = languages[currentLang].no_trend;
                }
                
                results = `
                    <p>${languages[currentLang].trend_result}: ${trendResult}</p>
                `;
                
                // Create chart with trend line
                createChartWithTrendline(
                    dataset.data.map(row => row[0]), // x-axis (labels)
                    numericData, // y-axis (values)
                    chartType,
                    `${languages[currentLang].trend_analysis}: ${languages[currentLang][dataset.headers[1]] || dataset.headers[1]}`
                );
            }
            
            // Update results container
            resultsContainer.innerHTML = results;
        }

        // Create a chart
        function createChart(labels, data, type, title) {
            // Destroy existing chart if any
            if (currentChart) {
                currentChart.destroy();
            }
            
            // Set chart colors based on dark mode
            const isDarkMode = document.documentElement.classList.contains('dark');
            const textColor = isDarkMode ? 'rgba(255, 255, 255, 0.8)' : 'rgba(0, 0, 0, 0.8)';
            const gridColor = isDarkMode ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';
            
            // Prepare datasets
            let datasets = [];
            let chartData = {};
            
            if (type === 'pie') {
                // For pie charts
                chartData = {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: [
                            'rgba(93, 92, 222, 0.8)',
                            'rgba(93, 92, 222, 0.6)',
                            'rgba(93, 92, 222, 0.4)',
                            'rgba(54, 162, 235, 0.8)',
                            'rgba(54, 162, 235, 0.6)',
                            'rgba(54, 162, 235, 0.4)'
                        ],
                        borderWidth: 1
                    }]
                };
            } else {
                // For bar and line charts
                chartData = {
                    labels: labels,
                    datasets: [{
                        label: title,
                        data: data,
                        backgroundColor: 'rgba(93, 92, 222, 0.5)',
                        borderColor: 'rgba(93, 92, 222, 1)',
                        borderWidth: 2,
                        tension: 0.3
                    }]
                };
            }
            
            // Create chart
            const ctx = chartContainer.getContext('2d');
            currentChart = new Chart(ctx, {
                type: type,
                data: chartData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: type === 'pie',
                            labels: {
                                color: textColor
                            }
                        },
                        title: {
                            display: true,
                            text: title,
                            color: textColor
                        }
                    },
                    scales: type !== 'pie' ? {
                        x: {
                            grid: {
                                color: gridColor
                            },
                            ticks: {
                                color: textColor
                            }
                        },
                        y: {
                            grid: {
                                color: gridColor
                            },
                            ticks: {
                                color: textColor
                            }
                        }
                    } : {}
                }
            });
        }

        // Create a scatter chart for correlation
        function createScatterChart(xData, yData, title) {
            // Destroy existing chart if any
            if (currentChart) {
                currentChart.destroy();
            }
            
            // Set chart colors based on dark mode
            const isDarkMode = document.documentElement.classList.contains('dark');
            const textColor = isDarkMode ? 'rgba(255, 255, 255, 0.8)' : 'rgba(0, 0, 0, 0.8)';
            const gridColor = isDarkMode ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';
            
            // Prepare data points
            const points = xData.map((x, i) => ({ x, y: yData[i] }));
            
            // Create chart
            const ctx = chartContainer.getContext('2d');
            currentChart = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: title,
                        data: points,
                        backgroundColor: 'rgba(93, 92, 222, 0.7)',
                        borderColor: 'rgba(93, 92, 222, 1)',
                        pointRadius: 6,
                        pointHoverRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            labels: {
                                color: textColor
                            }
                        },
                        title: {
                            display: true,
                            text: title,
                            color: textColor
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                color: gridColor
                            },
                            ticks: {
                                color: textColor
                            }
                        },
                        y: {
                            grid: {
                                color: gridColor
                            },
                            ticks: {
                                color: textColor
                            }
                        }
                    }
                }
            });
        }

        // Create chart with trendline
        function createChartWithTrendline(labels, data, chartType, title) {
            // Destroy existing chart if any
            if (currentChart) {
                currentChart.destroy();
            }
            
            // Set chart colors based on dark mode
            const isDarkMode = document.documentElement.classList.contains('dark');
            const textColor = isDarkMode ? 'rgba(255, 255, 255, 0.8)' : 'rgba(0, 0, 0, 0.8)';
            const gridColor = isDarkMode ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';
            
            // Calculate trendline
            const xValues = Array.from(Array(data.length).keys());
            let sumX = 0, sumY = 0, sumXY = 0, sumXX = 0;
            for (let i = 0; i < data.length; i++) {
                sumX += xValues[i];
                sumY += data[i];
                sumXY += xValues[i] * data[i];
                sumXX += xValues[i] * xValues[i];
            }
            const slope = (data.length * sumXY - sumX * sumY) / (data.length * sumXX - sumX * sumX);
            const intercept = (sumY - slope * sumX) / data.length;
            
            // Calculate trendline points
            const trendData = xValues.map(x => intercept + slope * x);
            
            // Create chart
            const ctx = chartContainer.getContext('2d');
            currentChart = new Chart(ctx, {
                type: chartType === 'bar' ? 'bar' : 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: title,
                            data: data,
                            backgroundColor: 'rgba(93, 92, 222, 0.5)',
                            borderColor: 'rgba(93, 92, 222, 1)',
                            borderWidth: 2,
                            tension: 0.3
                        },
                        {
                            label: 'Trend',
                            data: trendData,
                            type: 'line',
                            fill: false,
                            backgroundColor: 'rgba(255, 99, 132, 0.5)',
                            borderColor: 'rgba(255, 99, 132, 1)',
                            borderDash: [5, 5],
                            pointRadius: 0
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            labels: {
                                color: textColor
                            }
                        },
                        title: {
                            display: true,
                            text: title,
                            color: textColor
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                color: gridColor
                            },
                            ticks: {
                                color: textColor
                            }
                        },
                        y: {
                            grid: {
                                color: gridColor
                            },
                            ticks: {
                                color: textColor
                            }
                        }
                    }
                }
            });
        }

        // Event listeners
        languageSelector.addEventListener('change', function() {
            updateLanguage(this.value);
            displayDataset(dataSelect.value);
        });

        dataSelect.addEventListener('change', function() {
            displayDataset(this.value);
        });

        analyzeBtn.addEventListener('click', function() {
            const selectedDataset = dataSelect.value;
            const selectedAnalysisType = analysisType.value;
            const selectedChartType = chartType.value;
            
            // Generate code snippet
            const code = generateCodeSnippet(selectedDataset, selectedAnalysisType, selectedChartType);
            codeSnippet.textContent = code;
            
            // Perform analysis
            performAnalysis(selectedDataset, selectedAnalysisType, selectedChartType);
        });

        // Initialize
        updateLanguage('en');
        displayDataset('sales');
        
        // Generate initial code snippet
        const initialCode = generateCodeSnippet('sales', 'summary', 'bar');
        codeSnippet.textContent = initialCode;
    </script>
</body>
</html>